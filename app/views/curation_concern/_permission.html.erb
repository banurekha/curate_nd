<%#
Copyright © 2012 The Pennsylvania State University

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
%>
<fieldset id="permissions_display">
<% if curation_concern.persisted? %>
  <% depositor = curation_concern.depositor %>
  <% public_perm = curation_concern.permissions.map { |perm| perm[:access] if perm[:name] == "public"}.compact.first %>
  <% ndu_perm = curation_concern.permissions.map { |perm| perm[:access] if perm[:name] == "registered"}.compact.first %>
<%else %>
  <% depositor = current_user.user_key %>
  <% public_perm = true %>
  <% ndu_perm = false %>
<% end %>

<div id="permissions_display">
  <div class="alert hide" id="save_perm_note">Permissions are <strong>not</strong> saved until the &quot;Create Senior Thesis&quot; button is pressed at the bottom of the page.</div>
  <div class="alert alert-error hide" id="permissions_error"><a class="close" data-dismiss="alert" href="#">×</a><span id="permissions_error_text"></span></div>
  <legend>
    Permissions
    <small>Applied to the attached file</small>
    <a href="#myModal" role="button" class="btn btn-warning pull-right" data-toggle="modal">What's this <i class="icon-question-sign icon-large icon-white"></i></a>
  </legend>

  <!-- Modal -->

  <div class="modal hide fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
      <h2 id="myModalLabel"><%=t('sufia.product_name') %> Permissions</h2>
    </div>
    <div class="modal-body">
      <h3>Visibility</h3>
      <p>This setting will determine who can view your file, and the associated metadata. Setting
      the visibility to <span class="label label-success">Open Access</span> will allow your content to be discovered in Google and viewed by anyone.
      The visibility setting <span class="label label-info"><%=t('sufia.institution_name') %></span> will only allow users who are logged into <%=t('sufia.product_name') %>
      (via WebAccess) to view the content.  Files that are marked <span class="label label-important">Private</span> are only able to be viewed
      by users and/or groups that have been given specific access in the &quot;Share With&quot; section.
      </p>

      <p>
      Permissions in <%=t('sufia.product_name') %> are hierarchical.  This means that you cannot set the visibility of a file to <span class="label label-success">Open Access</span> or
      <span class="label label-info"><%=t('sufia.institution_name') %></span> and simultaneously try to restrict the access of a single user. However, you may mark the visibility of
      a file as <span class="label label-important">Private</span> and then grant access to particular users and/or groups for that file in the &quot;Share With&quot;
      section.
      </p>

      <h3>Share With</h3>
      <p>You may grant &quot;View/Download&quot; or &quot;Edit&quot;  access for specific users and/or groups to files. Enter
      a valid <%=t('sufia.account_name') %>, one at a time, select the access level for that user and click
      <button class="btn btn-mini btn-inverse" onclick="return false;"><i class="icon-plus-sign" ></i>Add</button>.
      </p>

      <h3>Permission Definitions</h3>
      <p>
      <strong>View/Download:</strong> this file (both contents and metadata) is accessible from within <%=t('sufia.product_name') %>.<br />
      <strong>Edit:</strong> this file (both contents and metadata) can be edited.  You may only grant this permission to <%=t('sufia.institution_name') %> users and/or groups.
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
  </div>

    <fieldset class="control-group">
      <legend class="nested-field-heading">
        Visibility
      </legend>
      <p class="help-block">
        Who should be able to read and download your files
      </p>

      <div class="controls">
        <label class="radio">
          <input type="radio" id="visibility_open" name="senior_thesis[visibility]" value="open" <% if !public_perm.blank? %> checked="true"<% end %>/>
          <span class="label label-success">Open Access</span> Visible to the world.
        </label>
        <label class="radio">
          <input type="radio" id="visibility_ndu" name="senior_thesis[visibility]" value="psu" <% if !ndu_perm.blank? %> checked="true"<% end %> />
          <span class="label label-info"><%=t('sufia.institution_name') %></span> Visible to all <%=t('sufia.institution_name') %> users.
        </label>
        <label class="radio">
          <input type="radio" id="visibility_restricted" name="senior_thesis[visibility]" value="restricted" <% if ndu_perm.blank? and public_perm.blank?%> checked="true"<% end %>/>
          <span class="label label-important">Private</span> Visible to users/groups specified below, if any.
        </label>
     </div><!-- /.controls -->

    </fieldset>

</fieldset>

